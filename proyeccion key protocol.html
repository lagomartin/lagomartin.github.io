<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora KEY Protocol - Proyección DAO</title>
    
    <!-- Cargar React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Cargar Prop-types -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- Cargar Recharts -->
    <script src="https://unpkg.com/recharts@2.12.2/umd/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fondo Principal solicitado: #3E6B2F */
        body { background-color: #3E6B2F; font-family: sans-serif; color: white; }
        
        /* Estilo para las tarjetas con fondo negro y 26% de opacidad */
        .card-dark {
            background-color: rgba(0, 0, 0, 0.26);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = window.Recharts;

        // --- ICONOS SVG (Blancos/Claros) ---
        const IconLightbulb = ({size=24, className=""}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="9" y1="18" x2="15" y2="18"></line><line x1="10" y1="22" x2="14" y2="22"></line><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 16.5 8 4.5 4.5 0 0 0 12 3.5 4.5 4.5 0 0 0 7.5 8c0 1.54.81 2.9 2.08 3.71s1.36 1.76 1.36 2.29"></path></svg>
        );

        // --- COMPONENTE PRINCIPAL ---
        const KeyProtocolDashboard = () => {
            // --- CONSTANTES DEL NEGOCIO (Inputs Fijos) ---
            const baseTokens = 20500;
            const baseFunds = 1440000;
            const baseInfraCost = 211550; // Ajustado para total 221,800
            const variableCost = 0.50; 
            
            // --- LÓGICA DE CÁLCULO ---
            
            const calculateScenario = (year, ngos, daoPercentageOverride) => {
                // 1. Escalamiento Lineal de Volumen (Tokens y Fondos)
                const multiplier = ngos / 5;
                const funds = baseFunds * multiplier;
                
                // 2. Costo KEY Protocol
                let keyTotalCost = 221800; // Base 2026
                if (year === 2027) keyTotalCost = 221800 * 1.25;
                if (year === 2028) keyTotalCost = (221800 * 1.25) * 1.25;

                // 3. Fondo DAO
                const daoAmount = keyTotalCost * (daoPercentageOverride / 100);

                // --- CÁLCULO DE EFICIENCIA GLOBAL ---
                const totalSystemCost = keyTotalCost + daoAmount;
                const globalEfficiencyPct = (totalSystemCost / funds) * 100;
                
                // --- PORCENTAJE DEL PRESUPUESTO OPERATIVO ---
                const daoShareOfBudget = daoAmount > 0 ? ((daoAmount / totalSystemCost) * 100).toFixed(1) + '%' : '';

                return {
                    year,
                    ngos,
                    funds,
                    keyTotalCost,
                    daoAmount,
                    totalSystemCost,
                    daoPercentageUsed: daoPercentageOverride,
                    globalEfficiencyPct,
                    daoShareOfBudget
                };
            };

            // Generar los 3 escenarios
            const scenario2026 = calculateScenario(2026, 5, 0);       // 0% DAO
            const scenario2027 = calculateScenario(2027, 12, 5.08);   // 5.08% DAO
            const scenario2028 = calculateScenario(2028, 25, 9.33);   // 9.33% DAO

            const data = [scenario2026, scenario2027, scenario2028];

            // Datos para Gráfica
            const chartData = data.map(s => ({
                name: s.year.toString(),
                ngos: s.ngos,
                Fondos: s.funds,
                CostoKEY: s.keyTotalCost,
                FondoDAO: s.daoAmount,
                // Etiquetas
                globalPct: s.globalEfficiencyPct.toFixed(2),
                daoUsed: s.daoPercentageUsed,
                daoShareLabel: s.daoShareOfBudget
            }));

            // Formateadores
            const formatCurrency = (val) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(val);
            
            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-7xl mx-auto space-y-8">
                        
                        {/* Título - Sin bordes de color */}
                        <div className="flex flex-col md:flex-row justify-between items-center card-dark p-6 rounded-xl shadow-sm">
                            <div>
                                <h1 className="text-2xl font-bold text-white">Tablero de Proyección KEY Protocol</h1>
                                <p className="text-slate-300 mt-1">Modelo de Financiamiento I+D+i (DAO) y Eficiencia de Escala.</p>
                            </div>
                            <div className="mt-4 md:mt-0 bg-blue-900/50 px-4 py-2 rounded-lg border border-blue-500/30">
                                <span className="text-xs font-bold text-blue-300 uppercase block mb-1">% Global</span>
                                <span className="text-sm text-blue-100">Costo Total del Ecosistema (KEY + DAO) sobre Capital Gestionado.</span>
                            </div>
                        </div>

                        {/* Comparativa de Tarjetas - Sin bordes superiores */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            
                            {/* 2026 */}
                            <div className="card-dark rounded-xl shadow-sm p-6 relative">
                                <h2 className="text-xl font-bold text-white mb-2">2026 <span className="text-sm font-normal text-slate-300">(5 ONGs)</span></h2>
                                <div className="text-xs text-slate-300 mb-4">Fondos Gestionados: <span className="text-white font-mono">{formatCurrency(scenario2026.funds)}</span></div>
                                
                                <div className="space-y-4">
                                    <div className="p-3 bg-slate-100 rounded-lg">
                                        <div className="flex justify-between items-center mb-1">
                                            <div className="text-xs text-slate-700 uppercase font-bold">Costo KEY</div>
                                            <span className="text-xs bg-slate-300 text-slate-800 px-2 rounded-full font-bold">Base</span>
                                        </div>
                                        <div className="text-xl font-bold text-slate-900">{formatCurrency(scenario2026.keyTotalCost)}</div>
                                    </div>
                                    
                                    <div className="p-3 bg-slate-200/20 rounded-lg border border-slate-500/30">
                                        <div className="flex justify-between items-center mb-1">
                                            <div className="text-xs text-slate-300 uppercase font-bold flex items-center gap-1"><IconLightbulb size={12}/> DAO (0%)</div>
                                        </div>
                                        <div className="text-xl font-bold text-slate-400">$0</div>
                                    </div>
                                </div>
                            </div>

                            {/* 2027 */}
                            <div className="card-dark rounded-xl shadow-sm p-6 relative">
                                <h2 className="text-xl font-bold text-white mb-2">2027 <span className="text-sm font-normal text-slate-300">(12 ONGs)</span></h2>
                                <div className="text-xs text-slate-300 mb-4">Fondos Gestionados: <span className="text-white font-mono">{formatCurrency(scenario2027.funds)}</span></div>
                                
                                <div className="space-y-4">
                                    <div className="p-3 bg-indigo-50 rounded-lg border border-indigo-100">
                                        <div className="flex justify-between items-center mb-1">
                                            <div className="text-xs text-indigo-800 uppercase font-bold">Costo KEY</div>
                                            <span className="text-xs bg-indigo-200 text-indigo-900 px-2 rounded-full font-bold">+25%</span>
                                        </div>
                                        <div className="text-xl font-bold text-indigo-900">{formatCurrency(scenario2027.keyTotalCost)}</div>
                                    </div>
                                    
                                    <div className="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                        <div className="flex justify-between items-center mb-1">
                                            <div className="text-xs text-orange-800 uppercase font-bold flex items-center gap-1"><IconLightbulb size={12}/> DAO</div>
                                            <span className="text-xs bg-orange-200 text-orange-900 px-2 rounded-full font-bold">
                                                {scenario2027.daoPercentageUsed}%
                                            </span>
                                        </div>
                                        <div className="text-xl font-bold text-orange-700">{formatCurrency(scenario2027.daoAmount)}</div>
                                        <div className="text-[10px] text-orange-600 mt-1">fondo I+D+i</div>
                                    </div>
                                </div>
                            </div>

                            {/* 2028 */}
                            <div className="card-dark rounded-xl shadow-sm p-6 relative">
                                <h2 className="text-xl font-bold text-white mb-2">2028 <span className="text-sm font-normal text-slate-300">(25 ONGs)</span></h2>
                                <div className="text-xs text-slate-300 mb-4">Fondos Gestionados: <span className="text-white font-mono">{formatCurrency(scenario2028.funds)}</span></div>
                                
                                <div className="space-y-4">
                                    <div className="p-3 bg-green-50 rounded-lg border border-green-100">
                                        <div className="flex justify-between items-center mb-1">
                                            <div className="text-xs text-green-800 uppercase font-bold">Costo KEY</div>
                                            <span className="text-xs bg-green-200 text-green-900 px-2 rounded-full font-bold">+25%</span>
                                        </div>
                                        <div className="text-xl font-bold text-green-900">{formatCurrency(scenario2028.keyTotalCost)}</div>
                                    </div>
                                    
                                    <div className="p-3 bg-orange-50 rounded-lg border border-orange-200">
                                        <div className="flex justify-between items-center mb-1">
                                            <div className="text-xs text-orange-800 uppercase font-bold flex items-center gap-1"><IconLightbulb size={12}/> DAO</div>
                                            <span className="text-xs bg-orange-200 text-orange-900 px-2 rounded-full font-bold">
                                                {scenario2028.daoPercentageUsed}%
                                            </span>
                                        </div>
                                        <div className="text-2xl font-bold text-orange-700">{formatCurrency(scenario2028.daoAmount)}</div>
                                        <div className="text-[10px] text-orange-600 mt-1">fondo I+D+i</div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        {/* Gráfica de Asignación */}
                        <div className="card-dark p-6 rounded-xl shadow-sm border border-slate-500/20">
                            <h3 className="text-lg font-bold text-white mb-2">Distribución del Presupuesto Operativo</h3>
                            <p className="text-sm text-slate-300 mb-6">Comparativa de Fondos (AUM) vs. Costos (KEY + DAO).</p>
                            
                            <div className="h-96 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={chartData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="rgba(255,255,255,0.1)" />
                                        <XAxis dataKey="name" tick={{fill: '#ffffff', fontWeight: 'bold'}} axisLine={false} tickLine={false} />
                                        <YAxis 
                                            tickFormatter={(val) => {
                                                if (val >= 1000000) return `$${val / 1000000}M`;
                                                return `$${val / 1000}k`;
                                            }} 
                                            axisLine={false} 
                                            tickLine={false} 
                                            tick={{fill: '#cccccc'}} 
                                        />
                                        
                                        {/* TOOLTIP MODIFICADO: cursor oscuro */}
                                        <Tooltip 
                                            cursor={{fill: 'rgba(0, 0, 0, 0.5)'}}
                                            formatter={(value, name) => [formatCurrency(value), name]}
                                            contentStyle={{borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.3)', backgroundColor: '#1e293b', color: 'white'}}
                                            itemStyle={{color: '#e2e8f0'}}
                                        />
                                        <Legend wrapperStyle={{ color: '#ffffff' }} />
                                        
                                        <Bar dataKey="Fondos" name="Capital Gestionado (AUM)" fill="#4ade80" radius={[4,4,0,0]} barSize={40} />
                                        
                                        {/* Barras Apiladas */}
                                        <Bar dataKey="CostoKEY" name="Costo Operativo KEY" stackId="a" fill="#818cf8" barSize={40} />
                                        <Bar 
                                            dataKey="FondoDAO" 
                                            name="Fondo I+D+i (DAO)" 
                                            stackId="a" 
                                            fill="#fb923c" 
                                            radius={[4,4,0,0]} 
                                            barSize={40} 
                                            label={(props) => {
                                                const { x, y, width, value, payload } = props;
                                                if (!value || value <= 0 || !payload) return null;
                                                const labelText = payload.daoShareLabel || '';
                                                return (
                                                    <text x={x + width / 2} y={y - 5} fill="#fb923c" textAnchor="middle" fontSize={12} fontWeight="bold">
                                                        {labelText}
                                                    </text>
                                                );
                                            }}
                                        />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Tabla Resumen Actualizada */}
                        <div className="card-dark rounded-xl shadow-sm p-6 overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                                <thead>
                                    <tr className="text-slate-300 text-xs uppercase border-b border-slate-600">
                                        <th className="py-3 px-4">Año</th>
                                        <th className="py-3 px-4">Fondos (AUM)</th>
                                        <th className="py-3 px-4 text-indigo-300">Costo KEY</th>
                                        <th className="py-3 px-4 text-orange-300">Fondo DAO</th>
                                        <th className="py-3 px-4 text-orange-300">Definición DAO</th>
                                        <th className="py-3 px-4 text-green-400 font-extrabold">% GLOBAL (Total/Fondos)</th>
                                    </tr>
                                </thead>
                                <tbody className="text-sm">
                                    {chartData.map((row) => (
                                        <tr key={row.name} className="border-b border-slate-600 hover:bg-white/5">
                                            <td className="py-4 px-4 font-bold text-white">{row.name} ({row.ngos} ONGs)</td>
                                            <td className="py-4 px-4 font-mono text-green-400">{formatCurrency(row.Fondos)}</td>
                                            <td className="py-4 px-4 font-mono text-indigo-300">{formatCurrency(row.CostoKEY)}</td>
                                            <td className="py-4 px-4 font-mono text-orange-300">{formatCurrency(row.FondoDAO)}</td>
                                            <td className="py-4 px-4 text-orange-300 text-xs">{row.daoUsed}% sobre KEY</td>
                                            <td className="py-4 px-4 font-bold text-green-400 text-lg">{row.globalPct}%</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<KeyProtocolDashboard />);
    </script>
</body>
</html>